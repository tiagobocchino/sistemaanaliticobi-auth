GUIA COMPLETO - CONSTRU√á√ÉO DO ANALYTICS PLATFORM DO ZERO
üìã PASSO A PASSO T√âCNICO DETALHADO
üîß FASE 1: PREPARA√á√ÉO DO AMBIENTE
bash
Copy
# 1. Criar estrutura de pastas
mkdir analytics-platform && cd analytics-platform

# 2. Criar ambiente virtual Python
python -m venv venv

# 3. Ativar ambiente
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate

# 4. Instalar depend√™ncias backend
pip install fastapi uvicorn python-dotenv pydantic-settings httpx asyncio
pip install supabase pandas numpy scikit-learn redis psutil
pip install agno openai groq

# 5. Criar estrutura de pastas
mkdir -p backend/src/{agents,analyses,auth,integrations,users,cache,monitoring,utils}
mkdir -p backend/database backend/tests backend/docs
mkdir -p frontend-rn/src/{screens,components,hooks,api,utils,context}

# 6. Inicializar frontend React Native
npx create-expo-app frontend-rn --template blank-typescript
cd frontend-rn
npm install @react-navigation/native @react-navigation/drawer
npm install react-native-screens react-native-safe-area-context
npm install @react-native-async-storage/async-storage
npm install axios react-native-chart-kit
npm install @expo/vector-icons
cd ..
üèóÔ∏è FASE 2: CONFIGURA√á√ÉO DO BACKEND
2.1 Arquivo de Configura√ß√£o Principal
Python
Copy
# backend/src/config.py
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # Supabase
    SUPABASE_URL: str = "https://sua-url.supabase.co"
    SUPABASE_ANON_KEY: str = "seu-anon-key"
    SUPABASE_SERVICE_ROLE_KEY: str = "seu-service-role-key"
    
    # Seguran√ßa
    SECRET_KEY: str = "sua-chave-secreta-super-segura"
    ENVIRONMENT: str = "development"
    
    # LLM Providers
    OLLAMA_BASE_URL: str = "http://localhost:11434/v1"
    OLLAMA_MODEL: str = "llama3.2"
    USE_OLLAMA: bool = True
    OPENAI_API_KEY: Optional[str] = None
    GROQ_API_KEY: Optional[str] = None
    
    # Redis
    REDIS_HOST: str = "localhost"
    REDIS_PORT: int = 6379
    REDIS_DB: int = 0
    
    # Performance
    CACHE_DEFAULT_TIMEOUT: int = 3600
    DEFAULT_PAGE_SIZE: int = 20
    MAX_PAGE_SIZE: int = 100
    
    class Config:
        env_file = ".env"

settings = Settings()
2.2 Cliente Supabase
Python
Copy
# backend/src/supabase_client.py
from supabase import create_client, Client
from .config import settings

class SupabaseClient:
    def __init__(self):
        self.client: Client = create_client(
            settings.SUPABASE_URL,
            settings.SUPABASE_SERVICE_ROLE_KEY
        )
    
    def get_client(self) -> Client:
        return self.client

supabase_client = SupabaseClient()
üîê FASE 3: SISTEMA DE AUTENTICA√á√ÉO
3.1 Modelos de Autentica√ß√£o
Python
Copy
# backend/src/auth/models.py
from pydantic import BaseModel, EmailStr
from typing import Optional

class UserSignup(BaseModel):
    email: EmailStr
    password: str
    full_name: str

class UserSignin(BaseModel):
    email: EmailStr
    password: str

class UserResponse(BaseModel):
    id: str
    email: str
    full_name: str
    cargo_id: Optional[int]
    divisao_id: Optional[int]
    nivel_acesso: Optional[int]
3.2 Servi√ßo de Autentica√ß√£o
Python
Copy
# backend/src/auth/service.py
from supabase import Client
from typing import Dict, Optional
from .models import UserSignup, UserSignin

class AuthService:
    def __init__(self, supabase_client: Client):
        self.client = supabase_client
    
    async def sign_up(self, user_data: UserSignup) -> Dict:
        """Registra novo usu√°rio"""
        try:
            # Criar usu√°rio no Supabase Auth
            auth_response = self.client.auth.sign_up({
                "email": user_data.email,
                "password": user_data.password
            })
            
            if auth_response.user:
                # Criar perfil no banco
                profile_data = {
                    "id": auth_response.user.id,
                    "email": user_data.email,
                    "full_name": user_data.full_name,
                    "created_at": datetime.now().isoformat()
                }
                
                self.client.table('usuarios').insert(profile_data).execute()
                
                return {
                    "user": auth_response.user,
                    "session": auth_response.session,
                    "message": "Usu√°rio criado com sucesso"
                }
            
            raise Exception("Erro ao criar usu√°rio")
            
        except Exception as e:
            raise Exception(f"Erro no signup: {str(e)}")
    
    async def sign_in(self, credentials: UserSignin) -> Dict:
        """Realiza login"""
        try:
            response = self.client.auth.sign_in_with_password({
                "email": credentials.email,
                "password": credentials.password
            })
            
            return {
                "access_token": response.session.access_token,
                "refresh_token": response.session.refresh_token,
                "user": response.user
            }
            
        except Exception as e:
            raise Exception(f"Erro no login: {str(e)}")

# Inst√¢ncia global
auth_service = AuthService(supabase_client.get_client())
üìä FASE 4: SISTEMA DE AN√ÅLISES
4.1 Modelos de An√°lises
Python
Copy
# backend/src/analyses/models.py
from pydantic import BaseModel
from typing import Optional, List
from datetime import datetime

class Analysis(BaseModel):
    id: Optional[int] = None
    nome: str
    descricao: str
    tipo: str  # 'powerbi', 'python', 'tableau'
    embed_url: Optional[str] = None
    divisao_restrita_id: Optional[int] = None
    publico: bool = True
    ativo: bool = True
    created_at: Optional[datetime] = None

class AnalysisResponse(Analysis):
    id: int
    created_at: datetime
4.2 Servi√ßo de An√°lises
Python
Copy
# backend/src/analyses/service.py
from typing import List, Optional, Dict
from .models import Analysis, AnalysisResponse

class AnalysisService:
    def __init__(self, supabase_client):
        self.client = supabase_client
    
    async def get_accessible_analyses(self, user_id: str, nivel_acesso: int, divisao_id: Optional[int]) -> List[Dict]:
        """Retorna an√°lises acess√≠veis ao usu√°rio"""
        
        query = self.client.table('analyses').select('*')
        
        # Aplicar filtros baseado no n√≠vel de acesso
        if nivel_acesso < 4:  # N√£o √© admin
            if divisao_id:
                query = query.or_(f'publico.eq.true,divisao_restrita_id.eq.{divisao_id}')
            else:
                query = query.eq('publico', True)
        
        result = query.eq('ativo', True).execute()
        return result.data if result.data else []
    
    async def create_analysis(self, analysis_data: Analysis) -> AnalysisResponse:
        """Cria nova an√°lise"""
        data = analysis_data.dict(exclude_none=True)
        data['created_at'] = datetime.now().isoformat()
        
        result = self.client.table('analyses').insert(data).execute()
        
        if result.data:
            return AnalysisResponse(**result.data[0])
        
        raise Exception("Erro ao criar an√°lise")

# Inst√¢ncia global
analysis_service = AnalysisService(supabase_client.get_client())
ü§ñ FASE 5: AGENTE IA
5.1 Agente Principal com Tools
Python
Copy
# backend/src/agents/core.py
from typing import Dict, List, Optional, Any
from datetime import datetime
import json

class AnalyticsAgent:
    def __init__(self, model_config: Dict[str, Any]):
        self.model_config = model_config
        self.tools = {
            "trend_analysis": self.analyze_trends,
            "compare_periods": self.compare_periods,
            "predict_sales": self.predict_sales,
            "find_opportunities": self.find_opportunities,
            "generate_chart": self.generate_chart
        }
        self.conversation_memory = []
    
    def analyze_trends(self, data: List[Dict]) -> Dict:
        """An√°lise de tend√™ncias temporais"""
        try:
            # Processar dados
            df = pd.DataFrame(data)
            df['data'] = pd.to_datetime(df['data'])
            
            # Calcular tend√™ncias
            values = df['valor'].values
            trend = np.polyfit(range(len(values)), values, 1)[0]
            
            # Gerar insights
            insights = []
            if trend > 0:
                growth_rate = (trend / np.mean(values)) * 100
                insights.append(f"üìà Tend√™ncia de crescimento: {growth_rate:.1f}% por per√≠odo")
            else:
                decline_rate = abs((trend / np.mean(values)) * 100)
                insights.append(f"üìâ Tend√™ncia de queda: {decline_rate:.1f}% por per√≠odo")
            
            return {
                "status": "success",
                "tendencia": "crescente" if trend > 0 else "decrescente",
                "inclinacao": float(trend),
                "media": float(np.mean(values)),
                "insights": insights,
                "dados": data
            }
            
        except Exception as e:
            return {
                "status": "error",
                "message": f"Erro na an√°lise de tend√™ncias: {str(e)}"
            }

    def process_message(self, message: str, user_context: Dict) -> Dict:
        """Processa mensagem do usu√°rio"""
        
        # Detectar inten√ß√£o
        intent = self._detect_intent(message)
        
        # Selecionar tool apropriada
        if intent == "trend_analysis":
            result = self.analyze_trends(user_context.get("data", []))
            response = self._format_trend_response(result)
            tools_used = ["trend_analysis"]
        elif intent == "comparison":
            result = self.compare_periods(user_context.get("data", []))
            response = self._format_comparison_response(result)
            tools_used = ["compare_periods"]
        else:
            response = self._format_general_response(message)
            tools_used = []
        
        return {
            "response": response,
            "tools_used": tools_used,
            "confidence": 85.0
        }
üì± FASE 6: FRONTEND REACT NATIVE
6.1 Configura√ß√£o da API
TypeScript
Copy
// frontend-rn/src/api/client.ts
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';

const API_BASE_URL = 'http://localhost:8000';

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,
});

// Interceptor para adicionar token
apiClient.interceptors.request.use(
  async (config) => {
    const token = await AsyncStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Interceptor para refresh token
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        const refreshToken = await AsyncStorage.getItem('refresh_token');
        const response = await apiClient.post('/auth/refresh', { refresh_token: refreshToken });
        
        await AsyncStorage.setItem('access_token', response.data.access_token);
        return apiClient(originalRequest);
      } catch (error) {
        await AsyncStorage.multiRemove(['access_token', 'refresh_token']);
        throw error;
      }
    }
    
    return Promise.reject(error);
  }
);
6.2 Hook de Autentica√ß√£o
TypeScript
Copy
// frontend-rn/src/hooks/useAuth.ts
import { useState, useEffect, createContext, useContext } from 'react';
import { apiClient } from '../api/client';
import AsyncStorage from '@react-native-async-storage/async-storage';

interface User {
  id: string;
  email: string;
  full_name: string;
  nivel_acesso: number;
  divisao_nome: string;
}

interface AuthContextType {
  user: User | null;
  loading: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType>({} as AuthContextType);

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    checkAuth();
  }, []);

  const checkAuth = async () => {
    try {
      const token = await AsyncStorage.getItem('access_token');
      if (token) {
        const response = await apiClient.get('/auth/me');
        setUser(response.data.user);
      }
    } catch (error) {
      await AsyncStorage.multiRemove(['access_token', 'refresh_token']);
    } finally {
      setLoading(false);
    }
  };

  const login = async (email: string, password: string) => {
    try {
      const response = await apiClient.post('/auth/signin', { email, password });
      
      await AsyncStorage.setItem('access_token', response.data.access_token);
      await AsyncStorage.setItem('refresh_token', response.data.refresh_token);
      
      setUser(response.data.user);
    } catch (error) {
      throw error;
    }
  };

  const logout = async () => {
    try {
      await apiClient.post('/auth/signout');
      await AsyncStorage.multiRemove(['access_token', 'refresh_token']);
      setUser(null);
    } catch (error) {
      console.error('Erro no logout:', error);
    }
  };

  return (
    <AuthContext.Provider value={{ user, loading, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth deve ser usado dentro de AuthProvider');
  }
  return context;
};
üóÑÔ∏è FASE 7: BANCO DE DADOS
7.1 SQL de Configura√ß√£o do Banco
sql
Copy
-- database/setup.sql
-- Cria√ß√£o de tabelas principais

CREATE TABLE IF NOT EXISTS public.cargos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(50) UNIQUE NOT NULL,
    nivel_acesso INTEGER NOT NULL CHECK (nivel_acesso BETWEEN 1 AND 5),
    ativo BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS public.divisoes (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(50) UNIQUE NOT NULL,
    codigo VARCHAR(10) UNIQUE NOT NULL,
    ativo BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS public.usuarios (
    id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    email VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    cargo_id INTEGER REFERENCES public.cargos(id),
    divisao_id INTEGER REFERENCES public.divisoes(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS public.analyses (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    descricao TEXT,
    tipo VARCHAR(50) NOT NULL CHECK (tipo IN ('powerbi', 'python', 'tableau')),
    embed_url TEXT,
    divisao_restrita_id INTEGER REFERENCES public.divisoes(id),
    publico BOOLEAN DEFAULT true,
    ativo BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Inserir dados iniciais
INSERT INTO public.cargos (nome, nivel_acesso) VALUES
    ('Analista', 1),
    ('Coordenador', 2),
    ('Gerente', 3),
    ('Diretor', 4),
    ('Master', 5);

INSERT INTO public.divisoes (nome, codigo) VALUES
    ('Comercial', 'COM'),
    ('Financeiro', 'FIN'),
    ('Tecnologia', 'TI'),
    ('RH', 'RH'),
    ('Marketing', 'MK');

-- Criar trigger para sincroniza√ß√£o
CREATE OR REPLACE FUNCTION handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO public.usuarios (id, email, full_name)
    VALUES (NEW.id, NEW.email, NEW.raw_user_meta_data->>'full_name');
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
    AFTER INSERT ON auth.users
    FOR EACH ROW EXECUTE FUNCTION handle_new_user();
üöÄ FASE 8: IMPLEMENTA√á√ÉO FINAL
8.1 Arquivo Main
Python
Copy
# backend/main.py
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager
import logging

from src.agents.routes import router as agents_router
from src.analyses.routes import router as analyses_router
from src.auth.routes import router as auth_router
from src.users.routes import router as users_router
from src.monitoring.routes import router as monitoring_router
from src.monitoring.system_monitor import system_monitor

# Configurar logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

@asynccontextmanager
async def lifespan(app: FastAPI):
    # Startup
    logger.info("üöÄ Iniciando Analytics Platform...")
    
    # Iniciar monitoramento em background
    asyncio.create_task(background_monitoring())
    
    yield
    
    # Shutdown
    logger.info("üõë Desligando Analytics Platform...")

app = FastAPI(
    title="Analytics Platform",
    description="Plataforma de an√°lises empresariais com IA",
    version="1.0.0",
    lifespan=lifespan
)

# CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:8085", "http://localhost:19006"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Rotas
app.include_router(auth_router, prefix="/api")
app.include_router(analyses_router, prefix="/api")
app.include_router(agents_router, prefix="/api")
app.include_router(users_router, prefix="/api")
app.include_router(monitoring_router, prefix="/api")

@app.get("/")
async def root():
    return {
        "message": "üöÄ Analytics Platform",
        "version": "1.0.0",
        "docs": "/docs",
        "health": "/health"
    }

@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "timestamp": datetime.now().isoformat(),
        "uptime": "running"
    }

async def background_monitoring():
    """Monitoramento em background"""
    while True:
        try:
            await system_monitor.collect_system_metrics()
            await asyncio.sleep(60)  # Coletar a cada minuto
        except Exception as e:
            logger.error(f"Erro no monitoramento: {e}")
            await asyncio.sleep(30)

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
üìö DOCUMENTA√á√ÉO T√âCNICA EXEMPLIFICADA
üéØ Vis√£o Geral do Sistema
O Analytics Platform √© uma solu√ß√£o empresarial completa que integra:
Backend: FastAPI + Python 3.11+ com arquitetura modular
Frontend: React Native + Expo com suporte Web/Mobile
Banco de Dados: Supabase (PostgreSQL com RLS)
IA: Agno Framework com m√∫ltiplos providers (Ollama, OpenAI, Groq)
Cache: Redis com fallback em mem√≥ria
Monitoramento: Sistema completo de m√©tricas e alertas
üèóÔ∏è Arquitetura T√©cnica
Copy
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (React Native)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Screens ‚Ä¢ Components ‚Ä¢ Hooks ‚Ä¢ Context ‚Ä¢ API Client       ‚îÇ
‚îÇ  Navigation ‚Ä¢ Theme ‚Ä¢ Cache ‚Ä¢ Performance                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ HTTP/HTTPS
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    BACKEND (FastAPI)                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Auth ‚Ä¢ Users ‚Ä¢ Analyses ‚Ä¢ Agents ‚Ä¢ Monitoring ‚Ä¢ Cache     ‚îÇ
‚îÇ  Middleware ‚Ä¢ Validation ‚Ä¢ Error Handling ‚Ä¢ Logging        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  DATABASE (Supabase)                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PostgreSQL ‚Ä¢ RLS ‚Ä¢ Triggers ‚Ä¢ Functions ‚Ä¢ Indexes         ‚îÇ
‚îÇ  Auth Users ‚Ä¢ Tables ‚Ä¢ Policies ‚Ä¢ Materialized Views       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SERVI√áOS EXTERNOS                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Ollama (LLM Local) ‚Ä¢ OpenAI ‚Ä¢ Groq ‚Ä¢ Redis ‚Ä¢ Power BI     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üîß Componentes Principais
Backend Components
Python
Copy
# Estrutura de diret√≥rios backend/
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ agents/          # Sistema de IA com tools
‚îÇ   ‚îú‚îÄ‚îÄ analyses/        # Gerenciamento de an√°lises
‚îÇ   ‚îú‚îÄ‚îÄ auth/           # Autentica√ß√£o e autoriza√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ cache/          # Sistema de cache
‚îÇ   ‚îú‚îÄ‚îÄ integrations/   # Integra√ß√µes externas
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/     # Monitoramento e m√©tricas
‚îÇ   ‚îú‚îÄ‚îÄ users/          # Gerenciamento de usu√°rios
‚îÇ   ‚îî‚îÄ‚îÄ utils/          # Utilit√°rios compartilhados
‚îú‚îÄ‚îÄ database/           # Scripts SQL
‚îú‚îÄ‚îÄ tests/              # Testes automatizados
‚îî‚îÄ‚îÄ main.py            # Entry point
Frontend Components
TypeScript
Copy
// Estrutura de diret√≥rios frontend/
frontend-rn/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ screens/        # Telas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ components/     # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ hooks/          # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ context/        # Context providers
‚îÇ   ‚îú‚îÄ‚îÄ api/            # Cliente API
‚îÇ   ‚îî‚îÄ‚îÄ utils/          # Utilit√°rios
‚îú‚îÄ‚îÄ assets/             # Imagens e fontes
‚îî‚îÄ‚îÄ App.tsx            # Entry point
üìä Fluxo de Dados
Mermaid
Fullscreen 
Download 
Copy
Code
Preview
Requisi√ß√£o

HTTP

Valida√ß√£o

Autorizado

Business Logic

Dados

JSON

UI Update

Usu√°rio
Frontend RN
FastAPI Backend
Auth Middleware
Service Layer
Database/Cache
Response
‚öôÔ∏è Configura√ß√£o de Desenvolvimento
Vari√°veis de Ambiente
bash
Copy
# .env
# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Security
SECRET_KEY=your-super-secret-key
ENVIRONMENT=development

# LLM
OLLAMA_BASE_URL=http://localhost:11434/v1
OLLAMA_MODEL=llama3.2
USE_OLLAMA=true

# Redis (opcional)
REDIS_HOST=localhost
REDIS_PORT=6379
üìã DOCUMENTA√á√ÉO METODOL√ìGICA DETALHADA
üéØ Metodologia de Desenvolvimento
1. Princ√≠pios de Arquitetura
SOLID Principles
Python
Copy
# Exemplo: Single Responsibility Principle
class UserAuthService:
    """Apenas respons√°vel por autentica√ß√£o"""
    def authenticate(self, credentials: dict) -> User:
        pass

class UserProfileService:
    """Apenas respons√°vel por perfil do usu√°rio"""
    def update_profile(self, user_id: str, data: dict) -> User:
        pass
Dependency Injection
Python
Copy
# backend/src/dependencies.py
from fastapi import Depends
from typing import Generator

def get_db() -> Generator:
    """Dependency para obter conex√£o com banco"""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

def get_current_user(token: str = Depends(oauth2_scheme)) -> User:
    """Dependency para obter usu√°rio autenticado"""
    return decode_token(token)
2. Padr√µes de Design Utilizados
Repository Pattern
Python
Copy
# backend/src/repositories/base.py
from abc import ABC, abstractmethod
from typing import Generic, TypeVar, List

T = TypeVar('T')

class BaseRepository(ABC, Generic[T]):
    """Repository base para opera√ß√µes CRUD"""
    
    @abstractmethod
    async def get_by_id(self, id: int) -> Optional[T]:
        pass
    
    @abstractmethod
    async def get_all(self, skip: int = 0, limit: int = 100) -> List[T]:
        pass
    
    @abstractmethod
    async def create(self, obj: T) -> T:
        pass
    
    @abstractmethod
    async def update(self, id: int, obj: T) -> Optional[T]:
        pass
    
    @abstractmethod
    async def delete(self, id: int) -> bool:
        pass
Factory Pattern
Python
Copy
# backend/src/factories/agent_factory.py
class AgentFactory:
    """Factory para criar agentes IA"""
    
    @staticmethod
    def create_agent(provider: str, config: Dict) -> AnalyticsAgent:
        if provider == "ollama":
            return OllamaAgent(config)
        elif provider == "openai":
            return OpenAIAgent(config)
        elif provider == "groq":
            return GroqAgent(config)
        else:
            raise ValueError(f"Provider n√£o suportado: {provider}")
3. Metodologia de Testes
Pir√¢mide de Testes
Copy
    /\
   /  \  E2E Tests (5%)
  /____\ Integration Tests (25%)
 /      \ Unit Tests (70%)
/________\
Exemplo de Teste Unit√°rio
Python
Copy
# backend/tests/test_auth.py
import pytest
from unittest.mock import Mock, patch
from src.auth.service import AuthService

class TestAuthService:
    @pytest.fixture
    def mock_supabase(self):
        return Mock()
    
    @pytest.fixture
    def auth_service(self, mock_supabase):
        return AuthService(mock_supabase)
    
    @pytest.mark.asyncio
    async def test_successful_login(self, auth_service, mock_supabase):
        # Arrange
        mock_response = Mock()
        mock_response.user = Mock(id="user123", email="test@example.com")
        mock_response.session = Mock(access_token="token123")
        mock_supabase.auth.sign_in_with_password.return_value = mock_response
        
        credentials = {"email": "test@example.com", "password": "password123"}
        
        # Act
        result = await auth_service.sign_in(credentials)
        
        # Assert
        assert result["access_token"] == "token123"
        assert result["user"].id == "user123"
    
    @pytest.mark.asyncio
    async def test_failed_login_invalid_credentials(self, auth_service, mock_supabase):
        # Arrange
        mock_supabase.auth.sign_in_with_password.side_effect = Exception("Invalid credentials")
        
        credentials = {"email": "test@example.com", "password": "wrongpassword"}
        
        # Act & Assert
        with pytest.raises(Exception) as exc_info:
            await auth_service.sign_in(credentials)
        
        assert "Invalid credentials" in str(exc_info.value)
4. Metodologia de Cache
Cache Strategy Pattern
Python
Copy
# backend/src/cache/strategies.py
from abc import ABC, abstractmethod
from typing import Any, Optional

class CacheStrategy(ABC):
    @abstractmethod
    async def get(self, key: str) -> Optional[Any]:
        pass
    
    @abstractmethod
    async def set(self, key: str, value: Any, ttl: int) -> bool:
        pass
    
    @abstractmethod
    async def delete(self, key: str) -> bool:
        pass

class RedisStrategy(CacheStrategy):
    def __init__(self, redis_client):
        self.redis = redis_client
    
    async def get(self, key: str) -> Optional[Any]:
        value = await self.redis.get(key)
        return json.loads(value) if value else None
    
    async def set(self, key: str, value: Any, ttl: int) -> bool:
        return await self.redis.setex(key, ttl, json.dumps(value))
    
    async def delete(self, key: str) -> bool:
        return await self.redis.delete(key) > 0

class MemoryStrategy(CacheStrategy):
    def __init__(self, max_size: int = 1000):
        self.cache = {}
        self.expiry = {}
        self.max_size = max_size
    
    async def get(self, key: str) -> Optional[Any]:
        if key in self.cache:
            if self.expiry[key] > datetime.now():
                return self.cache[key]
            else:
                del self.cache[key]
                del self.expiry[key]
        return None
    
    async def set(self, key: str, value: Any, ttl: int) -> bool:
        if len(self.cache) >= self.max_size:
            # Remove oldest item
            oldest_key = min(self.expiry.keys(), key=lambda k: self.expiry[k])
            del self.cache[oldest_key]
            del self.expiry[oldest_key]
        
        self.cache[key] = value
        self.expiry[key] = datetime.now() + timedelta(seconds=ttl)
        return True
5. Metodologia de Monitoramento
M√©tricas de Neg√≥cio vs T√©cnicas
Python
Copy
# backend/src/monitoring/metrics.py
from dataclasses import dataclass
from typing import Dict, List
from datetime import datetime

@dataclass
class BusinessMetrics:
    """M√©tricas de neg√≥cio"""
    revenue: float
    active_users: int
    conversion_rate: float
    avg_ticket: float
    churn_rate: float
    
@dataclass
class TechnicalMetrics:
    """M√©tricas t√©cnicas"""
    response_time: float
    error_rate: float
    cpu_usage: float
    memory_usage: float
    cache_hit_rate: float
    availability: float

class MetricsCollector:
    def collect_business_metrics(self) -> BusinessMetrics:
        """Coleta m√©tricas de neg√≥cio"""
        return BusinessMetrics(
            revenue=self.calculate_revenue(),
            active_users=self.count_active_users(),
            conversion_rate=self.calculate_conversion_rate(),
            avg_ticket=self.calculate_avg_ticket(),
            churn_rate=self.calculate_churn_rate()
        )
    
    def collect_technical_metrics(self) -> TechnicalMetrics:
        """Coleta m√©tricas t√©cnicas"""
        return TechnicalMetrics(
            response_time=self.measure_response_time(),
            error_rate=self.calculate_error_rate(),
            cpu_usage=self.get_cpu_usage(),
            memory_usage=self.get_memory_usage(),
            cache_hit_rate=self.get_cache_hit_rate(),
            availability=self.calculate_availability()
        )